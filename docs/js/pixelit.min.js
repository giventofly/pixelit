"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var pixelit=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.drawto=e.to||document.getElementById("pixelitcanvas"),this.drawfrom=e.from||document.getElementById("pixelitimg"),this.hideFromImg(),this.scale=e.scale&&e.scale>0&&e.scale<=50?.01*e.scale:.08,this.palette=e.palette||[[140,143,174],[88,69,99],[62,33,55],[154,99,72],[215,155,125],[245,237,186],[192,199,65],[100,125,52],[228,148,58],[157,48,59],[210,100,113],[112,55,127],[126,196,193],[52,133,157],[23,67,75],[31,14,28]],this.maxHeight=e.maxHeight,this.maxWidth=e.maxWidth,this.ctx=this.drawto.getContext("2d"),this.endColorStats={}}return _createClass(t,[{key:"hideFromImg",value:function(){return this.drawfrom?(this.drawfrom.style.visibility="hidden",this.drawfrom.style.position="fixed",this.drawfrom.style.top=0,this.drawfrom.style.left=0,this):this}},{key:"setFromImgSource",value:function(t){return this.drawfrom&&(this.drawfrom.src=t),this}},{key:"setDrawFrom",value:function(t){return this.drawfrom=t,this.hideFromImg(),this}},{key:"setDrawTo",value:function(t){return this.drawto=t,this.ctx=this.drawto.getContext("2d"),this}},{key:"setPalette",value:function(t){return this.palette=t,this}},{key:"setMaxWidth",value:function(t){return this.maxWidth=t,this}},{key:"setMaxHeight",value:function(t){return this.maxHeight=t,this}},{key:"setScale",value:function(t){return this.scale=t>0&&t<=50?.01*t:.08,this}},{key:"getPalette",value:function(){return this.palette}},{key:"colorSim",value:function(t,e){var i,a,r=0;for(i=0,a=t.length;i<a;i++){var h=t[i]-e[i];r+=h*h}return Math.sqrt(r)}},{key:"similarColor",value:function(t){for(var e=this.palette[0],i=this.colorSim(t,e),a=1;a<this.palette.length;a++){var r=this.palette[a],h=this.colorSim(t,r);h<=i&&(e=r,i=h)}return e}},{key:"pixelate",value:function(){if(!this.drawfrom)return this;var t=this.drawfrom.naturalWidth||this.drawfrom.width,e=this.drawfrom.naturalHeight||this.drawfrom.height;this.drawto.width=t,this.drawto.height=e;var i=this.scale,a=t*i,r=e*i,h=document.createElement("canvas");h.width=t,h.height=e,h.style.visibility="hidden",h.style.position="fixed",h.style.top="0",h.style.left="0",(t>900||e>900)&&(a=t*(i*=.5),r=e*i,h.width=Math.max(a,r)+50,h.height=Math.max(a,r)+50),h.getContext("2d").drawImage(this.drawfrom,0,0,a,r),document.body.appendChild(h),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1;var s=t;t>300&&(s+=t>e?parseInt(t/(t*i))/1.5:parseInt(t/(t*i)));var o=e;return e>300&&(o+=e>t?parseInt(e/(e*i))/1.5:parseInt(e/(e*i))),this.ctx.drawImage(h,0,0,a,r,0,0,s,o),h.remove(),this}},{key:"convertGrayscale",value:function(){for(var t=this.drawto.width,e=this.drawto.height,i=this.ctx.getImageData(0,0,t,e),a=i.data,r=0;r<a.length;r+=4){var h=(a[r]+a[r+1]+a[r+2])/3;a[r]=h,a[r+1]=h,a[r+2]=h}return this.ctx.putImageData(i,0,0),this}},{key:"convertPalette",value:function(){for(var t=this.drawto.width,e=this.drawto.height,i=this.ctx.getImageData(0,0,t,e),a=i.data,r=0;r<a.length;r+=4){var h=this.similarColor([a[r],a[r+1],a[r+2]]);a[r]=h[0],a[r+1]=h[1],a[r+2]=h[2]}return this.ctx.putImageData(i,0,0),this}},{key:"resizeImage",value:function(){if(!this.maxWidth&&!this.maxHeight)return this;var t=document.createElement("canvas"),e=t.getContext("2d"),i=1;return this.maxWidth&&this.drawto.width>this.maxWidth&&(i=this.maxWidth/this.drawto.width),this.maxHeight&&this.drawto.height>this.maxHeight&&(i=this.maxHeight/this.drawto.height),t.width=this.drawto.width,t.height=this.drawto.height,e.drawImage(this.drawto,0,0),this.drawto.width=Math.max(1,this.drawto.width*i),this.drawto.height=Math.max(1,this.drawto.height*i),this.ctx.drawImage(t,0,0,t.width,t.height,0,0,this.drawto.width,this.drawto.height),this}},{key:"draw",value:function(){if(!this.drawfrom)return this;var t=this.drawfrom.naturalWidth||this.drawfrom.width,e=this.drawfrom.naturalHeight||this.drawfrom.height;return this.drawto.width=t,this.drawto.height=e,this.ctx.drawImage(this.drawfrom,0,0),this.resizeImage(),this}},{key:"saveImage",value:function(){var t=document.createElement("a");t.download="pxArt.png",t.href=this.drawto.toDataURL("image/png").replace("image/png","image/octet-stream"),document.querySelector("body").appendChild(t),t.click(),document.querySelector("body").removeChild(t)}}]),t}();